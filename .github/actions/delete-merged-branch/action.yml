name: Delete merged branch

inputs:
  protected-branches:
    description: 'Comma separated protected branches (e.g., main,dev)'
    required: true
    default: 'main'

runs:
  using: composite
  steps:
    - name: Delete merged branch
      uses: actions/github-script@v7
      with:
        script: |
          const owner = context.repo.owner;
          const repo = context.repo.repo;
          const targetBranch = context.payload.pull_request.head.ref;

          // ë³´í˜¸ëœ ë¸Œëœì¹˜ëŠ” ì‚­ì œí•˜ì§€ ì•ŠìŒ
          const protectedBranches = '${{ inputs.protected-branches }}';
          if (protectedBranches.includes(targetBranch)) {
            console.log(`ğŸ›¡ï¸ Branch ${targetBranch} is protected. Skipping delete.`);
            return;
          }

          // ë¸Œëœì¹˜ ì œê±°
          await github.rest.git.deleteRef({
            owner,
            repo,
            ref: `heads/${targetBranch}`
          });

          console.log(`âœ… Deleted merged branch: ${targetBranch}`);
